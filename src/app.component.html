<main class="min-h-screen p-4 sm:p-6 lg:p-8 font-sans">
  <header class="mb-8">
    <h1 class="text-4xl font-bold text-purple-400">Monitoreo Corazones Dorados</h1>
    <p class="text-slate-400 mt-1">Vista en tiempo real del bienestar de los residentes.</p>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

    <!-- Tarjeta de Alerta de Caída -->
    <div class="lg:col-span-2 xl:col-span-1 p-6 rounded-2xl shadow-lg flex flex-col justify-between"
         [class]="patientData().fallDetected ? 'bg-red-500 text-white' : 'bg-slate-800 text-slate-100'">
      <h2 class="text-xl font-bold mb-2">Alerta de Caída</h2>
      @if (patientData().fallDetected) {
        <div class="flex items-center gap-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
          <div>
            <p class="text-5xl font-extrabold">¡CAÍDA DETECTADA!</p>
            <p class="text-lg mt-2">Ubicación: <strong>{{ patientData().fallLocation }}</strong></p>
            <p class="text-sm">Residente: {{ patientData().patientId }}</p>
          </div>
        </div>
      } @else {
        <div class="flex items-center gap-4">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          <div>
            <p class="text-3xl font-bold text-green-400">Sin Novedades</p>
            <p class="text-slate-400">No se han detectado caídas.</p>
          </div>
        </div>
      }
    </div>

    <!-- Tarjeta de Residente -->
    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg lg:row-span-2 flex flex-col">
      <h2 class="text-xl font-bold text-slate-100 mb-4 flex-shrink-0">Información del Residente</h2>
      
      <div class="flex items-center gap-4 flex-shrink-0">
        <div class="bg-purple-500 rounded-full h-16 w-16 flex items-center justify-center flex-shrink-0">
          <span class="text-white text-3xl font-bold">{{ patientData().patientId }}</span>
        </div>
        <div>
          <p class="text-slate-400">Última ubicación:</p>
          <p class="text-2xl font-semibold text-white">{{ patientData().currentRoom }}</p>
          <p class="text-sm text-slate-500">a las {{ lastSeen() }}</p>
        </div>
      </div>
       <!-- Estado de la Pulsera -->
      <div class="mt-4 pt-4 border-t border-slate-700 space-y-2 text-sm flex-shrink-0">
        <div class="flex items-center justify-between">
          <span class="font-medium text-slate-400">Pulsera</span>
          <div class="flex items-center gap-2" [title]="wristbandStatusText()">
            <div class="w-3 h-3 rounded-full" [class]="wristbandStatusBgColorClass()"></div>
            <span class="font-semibold" [class]="wristbandStatusColorClass()">{{ wristbandStatusText() }}</span>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <span class="font-medium text-slate-400">Batería</span>
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" [class]="batteryColorClass()" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 5a2 2 0 012-2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V5zm2 0h6v10H5V5z" clip-rule="evenodd" />
              <path d="M15 7a1 1 0 011-1h.5a1 1 0 011 1v6a1 1 0 01-1 1h-.5a1 1 0 01-1-1V7z" />
            </svg>
            @if (patientData().wristbandStatus !== 'disconnected') {
              <span class="font-semibold" [class]="batteryColorClass()">{{ patientData().wristbandBatteryLevel }}%</span>
            } @else {
              <span class="font-semibold text-slate-500">N/A</span>
            }
          </div>
        </div>
      </div>

      <!-- Condiciones Médicas -->
      <div class="mt-4 pt-4 border-t border-slate-700 flex-shrink-0">
        <h3 class="font-medium text-slate-400 mb-2">Condiciones Médicas</h3>
        <div class="flex flex-wrap gap-2">
          @for (condition of patientData().medicalConditions; track condition) {
            <span class="text-xs font-semibold bg-red-900/50 text-red-300 px-2 py-1 rounded-full">
              {{ condition }}
            </span>
          }
        </div>
      </div>
      
      <!-- Horario del Día -->
      <div class="mt-4 pt-4 border-t border-slate-700 flex-1 flex flex-col min-h-0">
        <h3 class="font-medium text-slate-400 mb-2 flex-shrink-0">Horario del Día</h3>
        <ul class="space-y-2 text-sm overflow-y-auto pr-2">
          @for (item of patientData().dailySchedule; track item.time) {
            <li class="flex justify-between items-center gap-2">
              <span class="text-slate-300 font-mono bg-slate-700 px-2 py-0.5 rounded">{{ item.time }}</span>
              <span class="text-right text-slate-400 truncate">{{ item.activity }}</span>
            </li>
          }
        </ul>
      </div>

    </div>

    <!-- Tarjeta de Movimiento -->
    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg flex flex-col justify-center items-center">
      <h2 class="text-xl font-bold text-slate-100 mb-4">Estado de Movimiento</h2>
      @if (patientData().isMoving) {
        <div class="text-center">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-400 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
          <p class="text-2xl font-bold text-green-400 mt-2">En Movimiento</p>
        </div>
      } @else {
        <div class="text-center">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-slate-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          <p class="text-2xl font-bold text-slate-400 mt-2">Detenido</p>
        </div>
      }
      <p class="text-slate-400 mt-4">Nivel de actividad: <span class="font-semibold" [class]="patientData().activityLevel === 'normal' ? 'text-purple-400' : 'text-indigo-400'">{{ patientData().activityLevel }}</span></p>
    </div>

    <!-- Tarjeta de Control de Iluminación -->
    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg transition-shadow duration-300"
         [class]="isLightOn() ? 'shadow-lg shadow-yellow-400/20' : ''">
      <h2 class="text-xl font-bold text-slate-100 mb-4">Control de Iluminación</h2>
      
      <!-- Selector de Habitación -->
      <div class="mb-4">
        <label for="room-select" class="block text-sm font-medium text-slate-400 mb-1">Habitación</label>
        <select id="room-select" 
                class="w-full bg-slate-700 text-white rounded-md border-slate-600 focus:ring-purple-500 focus:border-purple-500"
                [value]="selectedRoom()"
                (change)="selectedRoom.set($any($event.target).value)">
          @for (room of rooms; track room) {
            <option [value]="room">{{ room }}</option>
          }
        </select>
      </div>

      <div class="grid grid-cols-3 gap-4 items-center mb-4">
        <!-- Icono -->
        <div class="col-span-1 flex justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 transition-colors duration-300"
               [class]="isLightOn() ? 'text-yellow-300' : 'text-slate-600'" 
               viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 011.414 0l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM4 11a1 1 0 100-2H3a1 1 0 100 2h1z"/>
          </svg>
        </div>
        <!-- Estado -->
        <div class="col-span-2">
          <p class="text-3xl font-bold" [class]="isLightOn() ? 'text-white' : 'text-slate-400'">
            {{ isLightOn() ? 'Encendida' : 'Apagada' }}
          </p>
          <p class="text-slate-400 text-lg">Intensidad: {{ lightLevel() }}%</p>
        </div>
      </div>
      <!-- Deslizador -->
      <div class="mt-4">
        <input type="range" min="0" max="100" [value]="lightLevel()" (input)="updateLightLevel($event)" 
               class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
      </div>
       <!-- Acciones Rápidas -->
      <div class="flex gap-2 mt-4">
        <button (click)="toggleLight()" class="flex-1 text-sm font-semibold py-2 px-4 rounded-lg transition-colors"
                [class]="isLightOn() ? 'bg-red-600 hover:bg-red-700 text-white' : 'bg-green-600 hover:bg-green-700 text-white'">
          {{ isLightOn() ? 'Apagar' : 'Encender' }}
        </button>
        <button (click)="setNightLight()" 
                class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold py-2 px-4 rounded-lg transition-colors disabled:bg-slate-700 disabled:text-slate-400 disabled:cursor-not-allowed"
                [disabled]="!isLightOn()">
          Luz Nocturna
        </button>
      </div>
    </div>

    <!-- Tarjeta de Pasos Diarios -->
    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg">
      <h2 class="text-xl font-bold text-slate-100 mb-4">Pasos Diarios</h2>
      <div class="flex items-end justify-between">
        <p class="text-5xl font-extrabold text-white">{{ patientData().dailyStepCount }}</p>
        <p class="text-slate-400">/ {{ dailyStepGoal }} pasos</p>
      </div>
      <div class="w-full bg-slate-700 rounded-full h-4 mt-4">
        <div class="bg-purple-500 h-4 rounded-full" [style.width.%]="stepProgress()"></div>
      </div>
      <p class="text-right text-sm text-slate-400 mt-1">{{ stepProgress().toFixed(0) }}% completado</p>
    </div>
    
    <!-- Historial de Actividad (24h) -->
    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg md:col-span-2 lg:col-span-3 xl:col-span-2">
      <h2 class="text-xl font-bold text-slate-100 mb-2">Historial de Actividad (Últimas 24h)</h2>
      
      <div class="flex h-64 mt-6 pr-4">
        <!-- Eje Y -->
        <div class="flex flex-col justify-between h-full text-xs text-slate-400 mr-2 py-1">
          <span>Alto</span>
          <span>Bajo</span>
          <span>Nulo</span>
        </div>

        <!-- Área del Gráfico -->
        <div class="relative flex-grow h-full border-l border-b border-slate-600">
          <!-- Líneas de Guía -->
          <div class="absolute top-0 left-0 w-full h-px bg-slate-600" style="transform: translateY(-1px);"></div>
          <div class="absolute top-1/2 left-0 w-full h-px bg-slate-600 opacity-50"></div>
          
          <!-- Barras -->
          <div class="flex h-full items-end gap-px px-1">
            @for (activity of patientData().movementHistory; track $index) {
              <div class="flex-1 transition-all duration-300 group relative rounded-t-full" 
                   [style.height.%]="getActivityBarHeight(activity)" 
                   [class]="getActivityBarClass(activity)">
                   <div class="absolute bottom-full mb-2 w-max px-2 py-1 text-xs bg-slate-900 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none" style="left: 50%; transform: translateX(-50%);">
                      Nivel: {{ activity }}
                   </div>
              </div>
            }
          </div>

          <!-- Eje X -->
           <div class="absolute -bottom-6 left-0 w-full flex justify-between text-xs text-slate-400">
            <span>24h atrás</span>
            <span>19h</span>
            <span>14h</span>
            <span>9h</span>
            <span>4h</span>
            <span>Ahora</span>
          </div>
        </div>
      </div>

       <!-- Leyenda -->
      <div class="flex justify-center items-center gap-6 mt-10 text-sm text-slate-300">
        <div class="flex items-center gap-2">
          <div class="w-4 h-4 rounded-sm bg-purple-500"></div>
          <span>Actividad Normal</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-4 h-4 rounded-sm bg-indigo-500"></div>
          <span>Actividad Baja</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-4 h-4 rounded-sm bg-slate-600"></div>
          <span>Reposo / Nulo</span>
        </div>
      </div>
    </div>
    
  </div>
</main>